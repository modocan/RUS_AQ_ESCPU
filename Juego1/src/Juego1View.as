package {import assets.MunecoClase;import com.demonsters.debugger.MonsterDebugger;import com.hexagonstar.util.debug.Debug;import flash.display.MovieClip;import flash.events.Event;import flash.events.KeyboardEvent;import CronoEvents;import views.MunecoView;public class Juego1View extends MovieClip {            private var muneco:Muneco_mc;			            private var teclaPulsada:Boolean=false;            private var direccionMuneco:String;            private var vel:uint=9;            private var arr_gallinas:Array=new Array();            private var arr_huevos:Array= new Array();            private var arr_huevosSuelo:Array=new Array();			private var huevosRecolectados:uint=0;			private var fin:Boolean=false;            private var _ropa:Array = new Array();            private var clips_muneco:Array = ['personaje_mc', 'personajeCaminando'];            private const NUM_GALLINAS:uint=8;			private const INTERVALO_HUEVOS:uint=15;  // Tocar esto pa que caigan más o menos seguidos los huevos. menor número más huevos!!!!            private var timerAnimaciones:uint=0;            private var munecoCaminando:Boolean=false;            public function Juego1View() {                MonsterDebugger.initialize(this);                this.addEventListener(Event.ADDED_TO_STAGE, init);                super();            }            private function init(e:Event):void {                MonsterDebugger.trace(this, '[JUEGO1VIEW]');                MonsterDebugger.trace(this, this._ropa);                pintarJuego(_ropa); //Acá le paso la ropita del muñeco!!! :(                this.removeEventListener(Event.ADDED_TO_STAGE, init);                this.dispatchEvent(new Juego1Event(Juego1Event.JUEGO_CREADO));                stage.addEventListener(KeyboardEvent.KEY_DOWN, teclaPresionada);                stage.addEventListener(KeyboardEvent.KEY_UP, teclaNoPresionada);            }            public function pintarJuego(datos:Array){                // Poner todas las cosas!!!!                var fondo:FondoGallinero = new FondoGallinero();                fondo.x = 0;                fondo.y = 0;                addChild(fondo);                pintarGallinas();                crearMuneco(datos);            }            public function iniciarJuego():void {                addEventListener(Event.ENTER_FRAME, track);            }            private function teclaPresionada(e:KeyboardEvent):void {				if(fin){return;}                if(e.keyCode==39){                    direccionMuneco='d';                    teclaPulsada=true;                    if(!munecoCaminando){                        muneco.setAnimMuneco('personajeCaminando');                        munecoCaminando=true;                    }                }else if(e.keyCode==37){                    direccionMuneco='i';                    teclaPulsada=true;                    if(!munecoCaminando){                        muneco.setAnimMuneco('personajeCaminando');                        munecoCaminando=true;                    }                }else{                    teclaPulsada=false;                    direccionMuneco='';                    if(munecoCaminando){                        muneco.setAnimMuneco('');                        munecoCaminando=false;                    }                }            }            private function teclaNoPresionada(e:KeyboardEvent):void {                if(teclaPulsada && direccionMuneco==''){return;}                teclaPulsada=false;                direccionMuneco='';                if(munecoCaminando){                    muneco.setAnimMuneco('');                    munecoCaminando=false;                }            }            public function crearMuneco(datos:Array):void{                muneco=new Muneco_mc();                muneco.config('1',400,440);                muneco.vestirTodosLosMunecos(datos, clips_muneco);                muneco.ponerCesta();                addChild(muneco);                muneco.width = 120;                muneco.height = 212;            }            private function pintarGallinas():void {                for(var i:uint=0; i<NUM_GALLINAS;i++){                    var gallina:Gallina = new Gallina();                    arr_gallinas.push(gallina);                    gallina.x =Math.floor(Math.random()*750+40);                    gallina.y=80;                    gallina.addEventListener(Event.ADDED_TO_STAGE, initGallina);                    addChild(gallina);                 }                function initGallina(e:Event):void                {                    e.currentTarget.removeEventListener(Event.ADDED_TO_STAGE, initGallina);                    Gallina(e.currentTarget).anima();                }            }            private function track(e:Event):void{                // Mover muñeco:                if(teclaPulsada){                    var velocidad:Number =vel;                    if(muneco.x > 50 && direccionMuneco=='i'){                        velocidad = vel*-1;                        muneco.x = muneco.x+ velocidad;                    }                    if(muneco.x < 750 && direccionMuneco=='d'){                        muneco.x = muneco.x+ velocidad;                    }                }                //-------------------------                // Mover Gallinas:                for(var _g:uint=0; _g<arr_gallinas.length; _g++){                    if(Gallina(arr_gallinas[_g]).estado=='gallinaCaminaDer'){                        if(Gallina(arr_gallinas[_g]).x>=700){                            Gallina(arr_gallinas[_g]).anima('');                        } else{                            arr_gallinas[_g].x=arr_gallinas[_g].x+5;                        }                    }else if(Gallina(arr_gallinas[_g]).estado=='gallinaCaminaIzq'){                        if(Gallina(arr_gallinas[_g]).x<=50){                            Gallina(arr_gallinas[_g]).anima('');                        } else{                            arr_gallinas[_g].x=arr_gallinas[_g].x-5;                        }                    }                    //-------------------------                    // Mira si alguna gallona tiene que tirar un huevo para crear el nuevo huevo:										if(Gallina(arr_gallinas[_g]).tirar){						arr_gallinas[_g].tirar=false;						if(!fin){							var huevo:Huevo = new Huevo();							huevo.x = arr_gallinas[_g].x + 60;							huevo.y = arr_gallinas[_g].y + 80;							var rotacion:Number=(Math.random()*(-4))+2;							arr_huevos.push(new Array(huevo,rotacion));							Gallina(arr_gallinas[_g]).gotoAndPlay(1);							addChild(huevo);						}											}                    // Cambiar animacion de las gallinas:                    if(timerAnimaciones==30){                        if(!Gallina(arr_gallinas[_g]).tirar){                            Gallina(arr_gallinas[_g]).anima('');                        }                    }                }                //-------------------------                // Mover y parar huevos:                if(timerAnimaciones==INTERVALO_HUEVOS){                    tirarHuevos();                    timerAnimaciones=0;                }                timerAnimaciones++;                for(var h:uint = 0;h<arr_huevos.length;h++){                    if(arr_huevos[h][0]){ // si el huevo esta cayendo...                        arr_huevos[h][0].y += 8; // incrementa el Y						arr_huevos[h][0].rotation+=arr_huevos[h][1];                        if(arr_huevos[h][0].y>=520){  // Si ya llegó al suelo lo saca del array.							arr_huevos[h][0].rotation=0;                            arr_huevos[h][0].chocarYromper();                            arr_huevosSuelo.push(new Array(arr_huevos[h][0],0));							//trace('-- arr_huevos --'+arr_huevos);                            arr_huevos.splice(h,1);							//trace('---------- arr_huevos ---------'+arr_huevos);                        }                    }                //-------------------------                //Detecta colisión con cesta:					//trace('---------------  256:  '+arr_huevos[h][0]);                    if(arr_huevos[h]){                        if(muneco.cesta.zonaColision_mc.hitTestObject(arr_huevos[h][0])){                            colision(h);                        }                    }                }                //-------------------------                //Borra huevos piso:                for(var hue:int=0; hue<arr_huevosSuelo.length;hue++){					if(fin){break;}                    arr_huevosSuelo[hue][1]++;                    if(arr_huevosSuelo[hue][1]==144){                        arr_huevosSuelo[hue][0].gotoAndPlay('desaparecer');                    }                    if(!arr_huevosSuelo[hue][0]._visible){                        removeChild(arr_huevosSuelo[hue][0]);                        arr_huevosSuelo.splice(hue,1);                    }                }            } //------------------------- FIN TRACK!            //---------------------------------            private function colision(hue:uint):void {				if(fin){return;}                this.removeChild(arr_huevos[hue][0]);                arr_huevos.splice(hue,1);				huevosRecolectados++;				this.dispatchEvent(new Juego1Event(Juego1Event.PUNTO));				if(huevosRecolectados==3){					muneco.personaje_mc.cuerpo_mc.contenedorCesta_mc.getChildAt(0).y+=3;					muneco.personajeCaminando.cuerpo_mc.contenedorCesta_mc.getChildAt(0).y+=3;					huevosRecolectados=0;				}				            }            private function tirarHuevos():void {                for(var g:uint = 0;g<arr_gallinas.length;g++){                    var num:uint=Math.floor(Math.random()*10);                    if(num==5 || num==8){                        Gallina(arr_gallinas[g]).anima('gallinaAleteo');                        break;                    }                }            }						public function finJuego():void{				stage.removeEventListener(KeyboardEvent.KEY_DOWN, teclaPresionada);                stage.removeEventListener(KeyboardEvent.KEY_UP, teclaNoPresionada);				fin=true;				muneco.setAnimMuneco('');				teclaPulsada=false;			}    public function get ropa():Array {        return _ropa;    }    public function set ropa(value:Array):void {        _ropa = value;    }}}